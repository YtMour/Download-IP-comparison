# 🏢 多站点IP验证下载系统

一个企业级的多站点IP验证下载系统，支持统一后台管理多个软件库分站，具备完整的IP验证、下载控制和统计分析功能。

## 🎯 系统架构

### 🏗️ 双系统架构
```
🏢 总后端系统 (dw.ytmour.art)
├── 统一数据库和API
├── 管理面板
├── 下载器生成
└── 统计分析

🌐 站点拦截系统 (各分站)
├── home.ytmour.art (主软件库)
├── games.ytmour.art (游戏软件库)
├── tools.ytmour.art (工具软件库)
└── ... (更多分站)
```

### 🎯 核心特性

- **🏢 双系统分离** - 后端管理与前端拦截完全分离
- **🔐 智能IP验证** - 动态IP对比，防止跨地区滥用
- **🚀 预生成下载器** - GUI界面，无需动态编译
- **⚙️ 统一功能控制** - 总后台统一管理所有分站
- **📊 企业级统计** - 完整的下载记录和分析
- **🛡️ 安全机制** - API密钥、令牌过期、下载限制
- **📱 快速部署** - 模板化配置，几分钟部署新站点

## 🔄 工作流程

### IP验证逻辑
```
1. 用户点击下载 → 记录IP到数据库
2. 生成专属下载器 → 包含验证令牌
3. 用户运行下载器 → 动态获取当前IP
4. 与数据库对比 → 验证IP是否匹配
5. 验证通过下载 / 验证失败处理
```

### 管理控制流程
```
1. 部署总后端系统 → 一次性部署
2. 部署站点拦截系统 → 每个分站部署
3. 总后台统一管理 → 控制所有功能开关
4. 监控统计数据 → 查看系统运行状态
```

## 📁 项目结构

```
项目根目录/
├── README.md                    # 本文档
├── 项目结构说明.md              # 详细结构说明
├── 🏢 1-总后端系统/             # 部署到存储服务器
│   ├── README_后端部署.md       # 后端部署指南
│   ├── 后端部署脚本.sh          # 自动部署脚本
│   ├── admin/                   # 管理面板 (简化配置)
│   ├── api/                     # API接口
│   ├── downloader.exe          # 下载器程序
│   └── 调试工具/                # 配置和测试工具
└── 🌐 2-站点拦截系统/           # 部署到各分站
    ├── README_站点部署.md       # 站点部署指南
    ├── web_config_generator.php # Web配置生成器 (推荐)
    ├── 站点配置生成器.php       # 命令行配置生成器
    ├── download_handler.php    # 站点处理器模板
    ├── intercept.js            # 拦截器脚本模板
    └── test_page.html          # 测试页面
```

## 🚀 部署流程

### 第一步：部署总后端系统 (一次性)

1. **进入总后端目录**
   ```bash
   cd 1-总后端系统/
   ```

2. **查看部署指南**
   ```bash
   cat README_后端部署.md
   ```

3. **运行自动部署脚本**
   ```bash
   chmod +x 后端部署脚本.sh
   ./后端部署脚本.sh
   ```

4. **访问管理面板**
   ```
   https://dw.ytmour.art/admin/
   ```

### 第二步：部署站点拦截系统 (每个分站)

1. **进入站点拦截目录**
   ```bash
   cd 2-站点拦截系统/
   ```

2. **查看部署指南**
   ```bash
   cat README_站点部署.md
   ```

3. **生成站点配置**
   ```bash
   php 站点配置生成器.php
   ```

4. **上传到分站并测试**

## 🔧 配置说明

### 总后端配置
- **数据库连接** - MySQL/PostgreSQL连接信息
- **站点注册** - 所有分站的配置和API密钥
- **功能开关** - IP验证、严格模式等全局设置

### 站点拦截配置
- **站点标识** - 唯一的站点key
- **API密钥** - 与总后端通信的密钥
- **服务器地址** - 总后端服务器地址

## 🧪 测试验证

### 总后端测试
- 访问管理面板检查状态
- 测试API接口响应
- 验证数据库连接

### 站点拦截测试
- 点击下载链接测试拦截
- 验证下载器生成功能
- 测试IP验证流程

## 🚨 故障排除

### 常见问题
1. **数据库连接失败** - 检查配置和服务状态
2. **API调用失败** - 验证网络连接和密钥
3. **拦截器不工作** - 检查JavaScript和配置

### 获取帮助
- 查看对应系统的README文档
- 检查错误日志
- 使用测试页面验证功能

## 📊 系统优势

### 🎯 架构优势
- **职责分离** - 后端管理与前端拦截分离
- **部署简单** - 每个系统独立部署和维护
- **扩展容易** - 新增分站只需部署拦截系统

### 🔒 安全优势
- **IP验证** - 防止跨地区滥用
- **API密钥** - 分站身份验证
- **令牌过期** - 防止长期滥用
- **下载限制** - 次数和时间限制

### 📈 管理优势
- **统一控制** - 总后台管理所有功能
- **实时统计** - 完整的数据分析
- **日志审计** - 详细的操作记录

## 🎉 部署完成

部署完成后，您将拥有：
- ✅ 统一的总后台管理系统
- ✅ 多个独立的软件库分站
- ✅ 集中的IP验证和下载控制
- ✅ 完整的统计和监控功能

---

**版本**: 2.0 (双系统分离版)  
**更新日期**: 2025-01-01  
**兼容性**: 宝塔面板 + PHP 7.4+ + MySQL 5.7+  
**部署时间**: 总后端30分钟 + 每个分站10分钟
